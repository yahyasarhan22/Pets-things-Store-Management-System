{% extends "base.html" %}

{% block title %}Dashboard - Pets & Things{% endblock %}

{% block content %}
<!-- Hero Banner -->
<section class="dashboard-hero">
    <div class="hero-overlay"></div>
    <div class="hero-content">
        <img 
            src="{{ url_for('static', filename='images/paw.png') }}" 
            alt="Paw icon" 
            class="hero-paw"
        >
        <h1 class="hero-title">
            Welcome, {{ full_name or role|default('User') }}!
        </h1>
        <p class="hero-subtitle">
            {% if session.get('role') == 'customer' %}
                Browse products and manage your bookings easily
            {% elif session.get('role') == 'employee' %}
                Clock in/out and manage your daily shift
            {% else %}
                Manage your pet store with ease
            {% endif %}
        </p>
    </div>
</section>

{# =====================
   ADMIN DASHBOARD
   ===================== #}
{% if session.get('role') == 'admin' %}

<!-- KPI Cards Section -->
<section class="dashboard-stats">
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-icon stat-icon-products">
                <img src="{{ url_for('static', filename='images/paw.png') }}" alt="Products">
            </div>
            <div class="stat-info">
                <span class="stat-value">{{ products_count|default('--') }}</span>
                <span class="stat-label">Products Count</span>
            </div>
        </div>

        <a href="{{ url_for('inventory', status='LOW') }}"
           class="stat-card stat-card-low-stock {% if low_stock_count and low_stock_count > 0 %}stat-card-alert{% endif %}"
           style="cursor: pointer; text-decoration: none; color: inherit;">
            <div class="stat-icon stat-icon-stock">
                <img src="{{ url_for('static', filename='images/paw.png') }}" alt="Low Stock">
            </div>
            <div class="stat-info">
                <div style="display:flex; align-items:center; gap:8px;">
                    <span class="stat-value">{{ low_stock_count if low_stock_count is defined else '--' }}</span>
                    {% if low_stock_count and low_stock_count > 0 %}
                        <span style="font-size: 1.2rem;">‚ö†Ô∏è</span>
                    {% endif %}
                </div>
                <span class="stat-label">Low Stock Items</span>
            </div>
        </a>

        <a href="{{ url_for('sales_list') }}" class="stat-card" style="cursor: pointer; text-decoration: none; color: inherit;">
            <div class="stat-icon stat-icon-sales">
                <img src="{{ url_for('static', filename='images/paw.png') }}" alt="Sales">
            </div>
            <div class="stat-info">
                {% if today_sales %}
                    <div style="display:flex; flex-direction:column; gap:4px;">
                        <div style="font-size:0.85rem; color: var(--text-secondary);">
                            {{ today_sales.total_sales|default(0) }} sales
                        </div>
                        <span class="stat-value" style="font-size: 1.8rem;">
                            ${{ "%.2f"|format(today_sales.total_revenue or 0) }}
                        </span>
                    </div>
                {% else %}
                    <span class="stat-value">--</span>
                {% endif %}
                <span class="stat-label">Today Sales</span>
            </div>
        </a>

        <div class="stat-card">
            <div class="stat-icon stat-icon-bookings">
                <img src="{{ url_for('static', filename='images/paw.png') }}" alt="Bookings">
            </div>
            <div class="stat-info">
                <span class="stat-value">{{ active_bookings|default('--') }}</span>
                <span class="stat-label">Active Bookings</span>
            </div>
        </div>
    </div>
</section>

<!-- Quick Actions -->
<section class="dashboard-actions">
    <h2 class="section-title">Quick Actions</h2>
    <div class="actions-container">
        <a href="/products/add" class="action-card">
            <div class="action-icon">+</div>
            <span class="action-label">Add Product</span>
        </a>
        <a href="/sales/new" class="action-card">
            <div class="action-icon">$</div>
            <span class="action-label">New Sale</span>
        </a>
        <a href="/bookings/new" class="action-card">
            <div class="action-icon">B</div>
            <span class="action-label">New Booking</span>
        </a>
        <a href="/reports" class="action-card">
            <div class="action-icon">R</div>
            <span class="action-label">View Reports</span>
        </a>
    </div>
</section>

<!-- ‚úÖ Employee Attendance (Admin) ‚Äî card view to match your design -->
<section class="dashboard-actions">
    <h2 class="section-title">Employee Attendance Today</h2>

    <div class="actions-container">
        {% for e in employee_status %}
        <div class="action-card" style="cursor: default;">
            <div class="action-icon">üë§</div>

            <div style="display:flex; flex-direction:column; gap:6px;">
                <div style="font-weight:700;">{{ e.full_name }}</div>
                <div style="font-size:0.9rem; color: var(--text-secondary);">{{ e.email }}</div>

                <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:4px;">
                    <span class="badge {% if e.status == 'Working' %}badge-success{% elif e.status == 'Checked out' %}badge-info{% else %}badge-muted{% endif %}">
                        {{ e.status }}
                    </span>
                    <span style="font-size:0.9rem;">In: <b>{{ e.check_in or '--' }}</b></span>
                    <span style="font-size:0.9rem;">Out: <b>{{ e.check_out or '--' }}</b></span>
                    <span style="font-size:0.9rem;">Hours: <b>{{ e.hours_worked if e.hours_worked is not none else 0 }}</b></span>
                    <span style="font-size:0.9rem;">Salary: <b>${{ "%.2f"|format(e.daily_salary or 0) }}</b></span>
                </div>
            </div>
        </div>
        {% else %}
        <div class="action-card" style="cursor: default;">
            <div class="action-icon">‚ÑπÔ∏è</div>
            <span class="action-label">No employees found.</span>
        </div>
        {% endfor %}
    </div>
</section>

{# =====================
   EMPLOYEE DASHBOARD
   ===================== #}
{% elif session.get('role') == 'employee' %}

<section class="dashboard-stats">
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-icon stat-icon-sales">
                <img src="{{ url_for('static', filename='images/paw.png') }}" alt="Check In">
            </div>
            <div class="stat-info">
                <span class="stat-value">{{ today_attendance.check_in if today_attendance and today_attendance.check_in else '--' }}</span>
                <span class="stat-label">Today Check In</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon stat-icon-stock">
                <img src="{{ url_for('static', filename='images/paw.png') }}" alt="Check Out">
            </div>
            <div class="stat-info">
                <span class="stat-value">{{ today_attendance.check_out if today_attendance and today_attendance.check_out else '--' }}</span>
                <span class="stat-label">Today Check Out</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon stat-icon-products">
                <img src="{{ url_for('static', filename='images/paw.png') }}" alt="Hours">
            </div>
            <div class="stat-info">
                <span class="stat-value">{{ today_attendance.hours_worked if today_attendance and today_attendance.hours_worked is not none else '0' }}</span>
                <span class="stat-label">Hours Worked</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon stat-icon-bookings">
                <img src="{{ url_for('static', filename='images/paw.png') }}" alt="Salary">
            </div>
            <div class="stat-info">
                <span class="stat-value">${{ "%.2f"|format(today_attendance.daily_salary or 0) if today_attendance else "0.00" }}</span>
                <span class="stat-label">Today Salary</span>
            </div>
        </div>
    </div>
</section>

<section class="dashboard-actions">
    <h2 class="section-title">My Shift</h2>
    <div class="actions-container" style="grid-template-columns: repeat(2, 1fr);">
        <form action="{{ url_for('employee_check_in') }}" method="POST">
            <button type="submit" class="action-card" style="width:100%; border:none; background:none; cursor:pointer;">
                <div class="action-icon">üü¢</div>
                <span class="action-label">Check In</span>
            </button>
        </form>

        <form action="{{ url_for('employee_check_out') }}" method="POST">
            <button type="submit" class="action-card" style="width:100%; border:none; background:none; cursor:pointer;">
                <div class="action-icon">üî¥</div>
                <span class="action-label">Check Out</span>
            </button>
        </form>
    </div>
</section>

{# =====================
   CUSTOMER DASHBOARD
   ===================== #}
{% else %}

<section class="dashboard-actions" style="padding-top: 40px;">
    <h2 class="section-title">Quick Actions</h2>
    <div class="actions-container" style="grid-template-columns: repeat(2, 1fr);">
        <a href="/products/active" class="action-card">
            <div class="action-icon">üõçÔ∏è</div>
            <span class="action-label">Browse Products</span>
        </a>

        <a href="/bookings/new" class="action-card">
            <div class="action-icon">üìÖ</div>
            <span class="action-label">New Booking</span>
        </a>

        <a href="/bookings" class="action-card">
            <div class="action-icon">üìñ</div>
            <span class="action-label">My Bookings</span>
        </a>

        <a href="/products" class="action-card">
            <div class="action-icon">üîé</div>
            <span class="action-label">All Products</span>
        </a>
    </div>
</section>

{% endif %}
{% endblock %}
